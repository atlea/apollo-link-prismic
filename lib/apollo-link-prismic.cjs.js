"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var apolloLinkHttp=require("apollo-link-http"),tslib=require("tslib"),apolloLink=require("apollo-link");function extractPrismicMasterRef(e){return e.refs.filter((function(e){return e.isMasterRef}))[0].ref}function getPrismicGraphqlUrl(e){return"//"+e+".cdn.prismic.io/graphql"}function getPrismicRestApiUrl(e){return"//"+e+".cdn.prismic.io/api/v2"}var _fetch="undefined"==typeof window?global.fetch:window.fetch,PrismicLinkAuth=function(e){function t(t){var i=e.call(this)||this;return i.options=t,i}return tslib.__extends(t,e),t.prototype.request=function(e,t){var i=this.options,r=i.accessToken,n=i.fetch,o=void 0===n?_fetch:n,s=i.repositoryName,c=new URL(getPrismicRestApiUrl(s));return r&&c.searchParams.append("access_token",r),new apolloLink.Observable((function(i){var n;return o(""+c,{headers:{Accept:"application/json"}}).then((function(e){return e.json()})).then(extractPrismicMasterRef).then((function(t){var i=tslib.__assign({"Prismic-Ref":t},e.getContext().headers);return r&&Object.assign(i,{Authentication:r}),i})).then((function(t){return tslib.__assign(tslib.__assign({},e.getContext()),{headers:t})})).then(e.setContext).then((function(){n=t(e).subscribe({next:i.next.bind(i),error:i.error.bind(i),complete:i.complete.bind(i)})})).catch(i.error.bind(i)),function(){var e;return null===(e=n)||void 0===e?void 0:e.unsubscribe()}}))},t}(apolloLink.ApolloLink);function PrismicLink(e){var t={fetch:e.fetch,uri:getPrismicGraphqlUrl(e.repositoryName),useGETForQueries:!0};return new PrismicLinkAuth(e).concat(new apolloLinkHttp.HttpLink(t))}exports.PrismicLink=PrismicLink;
