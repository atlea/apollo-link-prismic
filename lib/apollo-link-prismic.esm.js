import{HttpLink as e}from"apollo-link-http";import{__extends as n,__assign as t}from"tslib";import{Observable as r,ApolloLink as o}from"apollo-link";function i(e){return e.refs.filter((function(e){return e.isMasterRef}))[0].ref}var c="undefined"==typeof window?global.fetch:window.fetch,s=function(e){function o(n){var t=e.call(this)||this;return t.options=n,t}return n(o,e),o.prototype.request=function(e,n){var o=this.options,s=o.accessToken,u=o.fetch,a=void 0===u?c:u,f=o.repositoryName,p=new URL("//"+f+".cdn.prismic.io/api/v2");return s&&p.searchParams.append("access_token",s),new r((function(r){var o;return a(""+p,{headers:{Accept:"application/json"}}).then((function(e){return e.json()})).then(i).then((function(n){var r=t({"Prismic-Ref":n},e.getContext().headers);return s&&Object.assign(r,{Authentication:s}),r})).then((function(n){return t(t({},e.getContext()),{headers:n})})).then(e.setContext).then((function(){o=n(e).subscribe({next:r.next.bind(r),error:r.error.bind(r),complete:r.complete.bind(r)})})).catch(r.error.bind(r)),function(){var e;return null===(e=o)||void 0===e?void 0:e.unsubscribe()}}))},o}(o);function u(n){var t,r={fetch:n.fetch,uri:(t=n.repositoryName,"//"+t+".cdn.prismic.io/graphql"),useGETForQueries:!0};return new s(n).concat(new e(r))}export{u as PrismicLink};
